<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/app.css') }}"
    />
<title>HomeNetSafe</title>
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>

<body>
  <!-- Top bar with small logo on the LEFT -->
  <div class="topbar">
    <div class="container row" style="padding:10px 16px">
      <div class="brand">
        <div class="cube">üõ°Ô∏è</div>
        <div>
          <h1>HomeNetSafe</h1>
          <div class="muted">Simple local network UI</div>
        </div>
        <button id="scanNetworkBtn" onclick="actualScan()" style="padding:8px 16px;border-radius:8px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;margin-left:16px;transition:all 0.3s ease;">Scan Network</button>
      </div>
      <div class="muted">v1 ‚Ä¢ minimal demo</div>
    </div>
  </div>

  <div class="container">
    <!-- Tabs (4 tabs) -->
  <input type="radio" name="tabs" id="tab-devices" checked>
  <input type="radio" name="tabs" id="tab-network">
  <input type="radio" name="tabs" id="tab-killswitch">
  <input type="radio" name="tabs" id="tab-settings">

    <div class="tabs">
      <div class="tab-labels">
        <label class="tab-label" for="tab-devices">Devices</label>
        <label class="tab-label" for="tab-network">Network Map</label>
        <label class="tab-label" for="tab-killswitch">Killswitch</label>
        <label class="tab-label" for="tab-settings">Settings</label>
      </div>
    </div>

    <div class="panes">
      <!-- ===== HOME: big centered 3D logo (clickable) ===== -->
            <!-- Device registration modal -->
      <div id="registerModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:101;background:rgba(0,0,0,0.55);">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border-radius:16px;padding:32px 24px;min-width:320px;max-width:90vw;box-shadow:0 0 32px #0008;">
          <h2 class="h2-header">Register Device</h2>
          <form id="registerForm" style="margin-top:20px;">
            <input type="hidden" id="regDeviceMac">
            <div style="margin-bottom:16px;">
              <label style="display:block;margin-bottom:8px;color:var(--muted);">Custom Name</label>
              <input type="text" id="regDeviceName" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:var(--bg);color:var(--ink);" required>
            </div>
            <div style="margin-bottom:16px;">
              <label style="display:block;margin-bottom:8px;color:var(--muted);">Notes</label>
              <textarea id="regDeviceNotes" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:var(--bg);color:var(--ink);min-height:80px;"></textarea>
            </div>
            <div style="text-align:center;margin-top:24px;">
              <button type="submit" style="padding:8px 24px;border-radius:8px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;margin-right:12px;">Register</button>
              <button type="button" onclick="document.getElementById('registerModal').style.display='none'" style="padding:8px 24px;border-radius:8px;background:#666;color:var(--ink);font-weight:700;border:none;cursor:pointer;">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Add Device Modal -->
      <div id="addDeviceModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:101;background:rgba(0,0,0,0.55);">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border-radius:16px;padding:32px 24px;min-width:320px;max-width:90vw;box-shadow:0 0 32px #0008;">
          <h2 class="h2-header">Add Registered Device</h2>
          <form id="addDeviceForm" style="margin-top:20px;">
            <div style="margin-bottom:16px;">
              <label style="display:block;margin-bottom:8px;color:var(--muted);">Device Name</label>
              <input type="text" id="addDeviceName" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:var(--bg);color:var(--ink);" required>
            </div>
            <div style="margin-bottom:16px;">
              <label style="display:block;margin-bottom:8px;color:var(--muted);">IP Address</label>
              <input type="text" id="addDeviceIP" placeholder="192.168.1.100" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:var(--bg);color:var(--ink);" required>
            </div>
            <div style="margin-bottom:16px;">
              <label style="display:block;margin-bottom:8px;color:var(--muted);">MAC Address (optional)</label>
              <input type="text" id="addDeviceMAC" placeholder="AA:BB:CC:DD:EE:FF" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:var(--bg);color:var(--ink);">
            </div>
            <div style="text-align:center;margin-top:24px;">
              <button type="submit" style="padding:8px 24px;border-radius:8px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;margin-right:12px;">Add Device</button>
              <button type="button" onclick="document.getElementById('addDeviceModal').style.display='none'" style="padding:8px 24px;border-radius:8px;background:#666;color:var(--ink);font-weight:700;border:none;cursor:pointer;">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- ===== DEVICES (output of discovered devices) ===== -->
      <section id="pane-devices" class="pane">
        <!-- Device Stats Summary -->
        <div class="card" style="margin-bottom:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div id="deviceStats" style="display:flex;gap:20px;font-size:14px;">
              <span id="totalDevices">0 devices</span>
              <span id="onlineDevices" style="color:#08f76f;">0 online</span>
              <span id="offlineDevices" style="color:#ff6b6b;">0 offline</span>
            </div>
            <div style="display:flex;gap:8px;align-items:center;">
              <input type="text" id="deviceSearch" placeholder="Search devices..." style="padding:6px 10px;border-radius:6px;border:1px solid var(--line);background:var(--bg);color:var(--ink);font-size:12px;">
              <label style="display:flex;align-items:center;gap:4px;font-size:12px;color:var(--muted);">
                <input type="checkbox" id="autoRefresh" checked> Auto-refresh
              </label>
              <button id="refreshBtn" style="padding:6px 10px;border-radius:6px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;font-size:12px;">üîÑ</button>
            </div>
          </div>
        </div>
        
        <!-- Discovered Devices Section -->
        <div class="card">
          <strong>Discovered Devices</strong>
          <div id="scanFailMsg" style="display:none;color:#ff3b3b;font-weight:700;text-align:center;margin:24px 0 18px;font-size:18px;">Scan failed. No devices found.</div>
          <div id="discoveredTableWrap" style="overflow:auto;margin-top:10px;">
            <table id="discoveredTable" style="width:100%;border-collapse:collapse">
              <colgroup>
                <col style="width:10%"> <!-- Status -->
                <col style="width:15%"> <!-- Name -->
                <col style="width:12%"> <!-- IP -->
                <col style="width:15%"> <!-- MAC -->
                <col style="width:15%"> <!-- Vendor -->
                <col style="width:12%"> <!-- First seen -->
                <col style="width:12%"> <!-- Last seen -->
                <col style="width:9%">  <!-- Action -->
              </colgroup>
              <thead>
                <tr style="background:rgba(0,229,255,.08);">
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">Status</th>
                  <th style="text-align:left;padding:12px 8px;font-weight:600;">Name</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">IP</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">MAC</th>
                  <th style="text-align:left;padding:12px 8px;font-weight:600;">Vendor</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">First seen</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">Last seen</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">Action</th>
                </tr>
              </thead>
              <tbody id="discoveredBody">
                <!-- Discovered device rows will be injected here -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Registered Devices Section -->
        <div class="card" style="margin-top:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <strong>Registered Devices</strong>
            <button id="addDeviceBtn" style="padding:6px 12px;border-radius:6px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;font-size:12px;">+ Add Device</button>
          </div>
          <div id="manualTableWrap" style="overflow:auto;margin-top:10px;">
            <table id="manualTable" style="width:100%;border-collapse:collapse">
              <colgroup>
                <col style="width:20%"> <!-- Name -->
                <col style="width:15%"> <!-- IP -->
                <col style="width:20%"> <!-- MAC -->
                <col style="width:20%"> <!-- Vendor -->
                <col style="width:15%"> <!-- Added -->
                <col style="width:10%"> <!-- Action -->
              </colgroup>
              <thead>
                <tr style="background:rgba(0,229,255,.08);">
                  <th style="text-align:left;padding:12px 8px;font-weight:600;">Name</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">IP</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">MAC</th>
                  <th style="text-align:left;padding:12px 8px;font-weight:600;">Vendor</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">Added</th>
                  <th style="text-align:center;padding:12px 8px;font-weight:600;">Action</th>
                </tr>
              </thead>
              <tbody id="manualBody">
                <!-- Registered device rows will be injected here -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ===== NETWORK MAP ===== -->
      <section id="pane-network" class="pane">
        <div class="card">
          <strong>Network Map</strong>
          <div id="networkMap" style="margin-top:16px;min-height:400px;border:1px solid var(--line);border-radius:8px;padding:20px;background:var(--bg);position:relative;overflow:hidden;">
            <div id="mapDevices" style="display:flex;flex-wrap:wrap;gap:16px;justify-content:center;align-items:center;">
              <!-- Network devices will be rendered here -->
            </div>
          </div>
        </div>
      </section>

      <!-- ===== KILLSWITCH (placeholder) ===== -->
      <section id="pane-killswitch" class="pane">
        <div class="card center">
          <strong>Killswitch</strong>
          <div class="muted" style="margin-top:10px">This will reset the network in case of failure.<br>Feature coming soon.</div>
        </div>
      </section>

      <!-- ===== SETTINGS ===== -->
      <section id="pane-settings" class="pane">
        <div class="grid grid-2">
          <!-- Network Connection Status -->
          <div class="card">
            <strong>Network Connection</strong>
            <div id="networkConnectionStatus" style="margin-top:16px;">
              <div id="connectionType" style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                <div id="connectionIcon" style="font-size:24px;">üîå</div>
                <div style="flex:1;">
                  <div id="connectionLabel" style="font-weight:700;color:var(--accent);">Ethernet Connection</div>
                  <div id="connectionDetails" style="font-size:12px;color:var(--muted);">Wired network connection</div>
                  <div id="localIpAddress" style="font-size:11px;color:var(--ink);margin-top:2px;font-family:monospace;background:rgba(0,229,255,0.1);padding:2px 6px;border-radius:3px;display:inline-block;">192.168.1.100</div>
                </div>
              </div>
              <div id="securityStatus" style="padding:8px 12px;border-radius:6px;background:rgba(8,247,111,0.1);border-left:3px solid #08f76f;">
                <div style="font-size:12px;font-weight:600;color:#08f76f;">‚úì Secure Connection</div>
                <div id="securityDetails" style="font-size:11px;color:var(--muted);margin-top:2px;">Not using WiFi</div>
              </div>
            </div>
          </div>
          
          <!-- Preferences -->
          <div class="card">
            <strong>Preferences</strong>
            <div style="height:8px"></div>
            <div class="row"><span class="muted">Show tips</span><button class="btn-ghost" onclick="toggle(this)">On</button></div>
            <div class="row" style="margin-top:8px"><span class="muted">Auto-scan new devices</span><button class="btn-ghost" onclick="toggle(this)">Off</button></div>
            <div class="row" style="margin-top:8px"><span class="muted">Auto-refresh devices</span><button class="btn-ghost" onclick="toggle(this)">On</button></div>
          </div>
          
          <!-- System Information -->
          <div class="card">
            <strong>System Information</strong>
            <div style="margin-top:12px;font-size:12px;color:var(--muted);line-height:1.6;">
              <div><strong>Version:</strong> HomeNetSafe v2.0</div>
              <div><strong>Database:</strong> SQLite</div>
              <div><strong>Status:</strong> <span style="color:#08f76f;">Running</span></div>
              <div><strong>Uptime:</strong> <span id="systemUptime">Loading...</span></div>
            </div>
          </div>
          
          <!-- About -->
          <div class="card">
            <strong>About</strong>
            <p class="muted" style="margin-top:8px;font-size:12px;line-height:1.5;">HomeNetSafe is a network monitoring tool designed for 24/7 operation. It provides real-time device discovery, security monitoring, and network visualization.</p>
            <div style="margin-top:12px;">
              <button onclick="exportDevices()" style="padding:6px 12px;border-radius:6px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;font-size:11px;margin-right:8px;">Export Data</button>
              <button onclick="showSystemLogs()" style="padding:6px 12px;border-radius:6px;background:#666;color:var(--ink);font-weight:700;border:none;cursor:pointer;font-size:11px;">View Logs</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- ===== Fullscreen overlay for code rain transition ===== -->
  <!-- ===== Instruction Modal ===== -->
  <div id="instructionModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:101;background:rgba(0,0,0,0.55);">
    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border-radius:16px;padding:32px 24px;min-width:320px;max-width:90vw;box-shadow:0 0 32px #0008;">
      <h2 style="margin-top:0;color:var(--accent);font-size:22px;text-align:center;">Instructions</h2>
      <div style="color:var(--ink);font-size:16px;line-height:1.7;margin:18px 0 0;">
        <ul>
          <li>Click the big logo to scan your network for devices.</li>
          <li>View discovered devices in the Devices tab.</li>
          <li>If the scan fails, you will see an error message.</li>
          <li>Use the Killswitch tab to reset your network (coming soon).</li>
          <li>Contact us via email for support or questions.</li>
        </ul>
      </div>
      <div style="text-align:center;margin-top:18px;">
        <button onclick="document.getElementById('instructionModal').style.display='none'" style="padding:8px 24px;border-radius:8px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;">Close</button>
      </div>
    </div>
  </div>
  <!-- ===== Footer ===== -->
  <footer style="width:100%;background:var(--panel);border-top:1px solid var(--line);padding:18px 0 12px;position:fixed;bottom:0;left:0;z-index:99;text-align:center;">
    <div style="margin-bottom:8px;color:var(--muted);font-size:15px;">
      Questions? Contact us at <a href="mailto:support@homenetsafe.com" style="color:var(--accent);text-decoration:none;font-weight:600;">support@homenetsafe.com</a>
    </div>
    <button onclick="document.getElementById('instructionModal').style.display='block'" style="padding:10px 28px;border-radius:10px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;font-size:16px;box-shadow:0 2px 8px #00e5ff22;">Instructions</button>
  </footer>
  <div id="matrixOverlay" aria-hidden="true">
    <canvas id="matrixCanvas"></canvas>
    <div id="matrixText"></div>
  </div>

  <!-- ===== Scan Result Modal ===== -->
  <div id="scanResultModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:100;background:rgba(0,0,0,0.55);">
    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border-radius:16px;padding:32px 24px;min-width:320px;max-width:90vw;box-shadow:0 0 32px #0008;">
      <h2 style="margin-top:0;color:var(--accent);font-size:22px;text-align:center;">Scan Result</h2>
      <pre id="scanResultText" style="background:#061017;color:#eaffff;padding:16px;border-radius:10px;max-height:40vh;overflow:auto;font-size:15px;white-space:pre-wrap;word-break:break-word;margin:18px 0 0;text-align:left;"></pre>
      <div style="text-align:center;margin-top:18px;">
        <button onclick="document.getElementById('scanResultModal').style.display='none'" style="padding:8px 24px;border-radius:8px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;">Close</button>
      </div>
    </div>
  </div>

  <!-- ===== Toast Notifications ===== -->
  <div id="toastContainer" style="position:fixed;top:20px;right:20px;z-index:200;"></div>

  <!-- ===== Device History Modal ===== -->
  <div id="historyModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:101;background:rgba(0,0,0,0.55);">
    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border-radius:16px;padding:32px 24px;min-width:400px;max-width:90vw;max-height:80vh;overflow:auto;box-shadow:0 0 32px #0008;">
      <h2 class="h2-header">Device History</h2>
      <div id="historyContent" style="margin-top:20px;"></div>
      <div style="text-align:center;margin-top:24px;">
        <button onclick="document.getElementById('historyModal').style.display='none'" style="padding:8px 24px;border-radius:8px;background:var(--accent);color:#032c33;font-weight:700;border:none;cursor:pointer;">Close</button>
      </div>
    </div>
  </div>

  {{temp_var}}

   <script
      type="text/javascript"
      src="{{ url_for('static', filename='js/app.js') }}">
    </script>
    <script
      type="text/javascript"
      src="{{ url_for('static', filename='js/network-map.js') }}">
    </script>
</body>
</html>